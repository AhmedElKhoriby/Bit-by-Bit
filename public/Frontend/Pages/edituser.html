<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Edit User</title>
        <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="../Styles/Dashboard.css" />
    </head>
    <body>
        <div id="navbar-container"></div>

        <div class="container">
            <h2>Edit User</h2>
            <form id="editUserForm">
                <div class="mb-3">
                    <label class="form-label">Full Name</label>
                    <input
                        type="text"
                        class="form-control"
                        id="name"
                        required
                    />
                </div>

                <div class="mb-3">
                    <label class="form-label">Email</label>
                    <input
                        type="email"
                        class="form-control"
                        id="email"
                        required
                    />
                </div>

                <div class="mb-3">
                    <label class="form-label"
                        >Password (Leave empty to keep current)</label
                    >
                    <input type="password" class="form-control" id="password" />
                </div>

                <div class="mb-3">
                    <label class="form-label">Role</label>
                    <select id="role" class="form-select">
                        <option value="user">User</option>
                        <option value="admin">Admin</option>
                    </select>
                </div>

                <button type="submit" class="btn btn-success">
                    Update User
                </button>
                <a href="users.html" class="btn btn-secondary">Cancel</a>
            </form>
        </div>

        <script>
            fetch("partials/nav.html")
                .then((res) => res.text())
                .then(
                    (data) =>
                        (document.getElementById("navbar-container").innerHTML =
                            data)
                );
            const urlParams = new URLSearchParams(window.location.search);
            const userId = urlParams.get("id");
        </script>
        <script>
            fetch(`http://127.0.0.1:8000/api/users/${userId}`)
                .then((res) => res.json())
                .then((response) => {
                    if (response.success) {
                        const user = response.data;
                        document.getElementById("name").value = user.name;
                        document.getElementById("email").value = user.email;
                        document.getElementById("role").value = user.role;
                    } else {
                        alert("Failed to load user data");
                    }
                });

            // تعديل بيانات اليوزر
            document
                .getElementById("editUserForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();

                    const updatedUser = {
                        name: document.getElementById("name").value,
                        email: document.getElementById("email").value,
                        role: document.getElementById("role").value,
                    };

                    const password = document.getElementById("password").value;
                    if (password.trim() !== "") {
                        updatedUser.password = password;
                    }

                    fetch(`http://127.0.0.1:8000/api/users/${userId}`, {
                        method: "PUT",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(updatedUser),
                    })
                        .then((res) => res.json())
                        .then((response) => {
                            if (response.success) {
                                alert("User updated successfully!");
                                window.location.href = "users.html";
                            } else {
                                alert("Failed to update user");
                            }
                        })
                        .catch((err) => alert("Error: " + err.message));
                });
        </script>
    </body>
</html>
